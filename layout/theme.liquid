{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
NOTE TO DEVELOPERS: welcome to Impact theme! We hope that you will enjoy editing this theme as much as we did for
  developing it. We have put a lot of work to make this theme as developer friendly as possible by offering you
  hooks to integrate into critical parts of the theme. You will find the complete technical documentation (including
  all events, dependencies...) in the "documentation.txt" file, located in the Assets folder.
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<!doctype html>

<html lang="{{ request.locale.iso_code }}" dir="{% render 'direction' %}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="theme-color" content="{{ settings.header_background }}">

    <title>{% if page_title == blank %}{{ shop.name }}{% else %}{{ page_title }}{% if current_page != 1 %} &ndash; {{ 'general.page' | t: page: current_page }}{% endif %}{% endif %}</title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96 }}">
      <link rel="apple-touch-icon" href="{{ settings.favicon | image_url: width: 180 }}">
    {%- endif -%}

    {%- comment -%}Few prefetch to increase performance on commonly used third-parties{%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">

    {%- unless settings.heading_font.system? -%}
      <link rel="preload" href="{{ settings.heading_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- unless settings.text_font.system? -%}
      <link rel="preload" href="{{ settings.text_font | font_url }}" as="font" type="font/woff2" crossorigin>
    {%- endunless -%}

    {%- render 'social-meta-tags' -%}
    {%- render 'microdata-schema' -%}
    {%- render 'css-variables' -%}
    {%- render 'js-variables' -%}

    <script>
      if (!(HTMLScriptElement.supports && HTMLScriptElement.supports('importmap'))) {
        const importMapPolyfill = document.createElement('script');
        importMapPolyfill.async = true;
        importMapPolyfill.src = "{{ 'es-module-shims.min.js' | asset_url }}";

        document.head.appendChild(importMapPolyfill);
      }
    </script>

    <script type="importmap">
      {%- comment -%}On Safari 16.3 and lower, a polyfill is used to load importmap{%- endcomment -%}
      {
        "imports": {
          "vendor": "{{ 'vendor.min.js' | asset_url }}",
          "theme": "{{ 'theme.js' | asset_url }}",
          "photoswipe": "{{ 'photoswipe.min.js' | asset_url }}"
        }
      }
    </script>

    <script type="module" src="{{ 'vendor.min.js' | asset_url }}"></script>
    <script type="module" src="{{ 'theme.js' | asset_url }}"></script>

    {{ content_for_header }}

    {{- 'theme.css' | asset_url | stylesheet_tag: preload: true -}}
  </head>

  <body class="{% if settings.zoom_image_on_hover %}zoom-image--enabled{% endif %}">
    {%- render 'shadow-dom-templates' -%}

    <a href="#main" class="skip-to-content sr-only">{{ 'general.accessibility.skip_to_content' | t }}</a>

    {%- if request.page_type != 'password' -%}
      {%- sections 'header-group' -%}
      {%- sections 'overlay-group' -%}

      {%- if settings.cart_type == 'popover' -%}
        <cart-notification-drawer open-from="bottom" class="quick-buy-drawer drawer"></cart-notification-drawer>
      {%- endif -%}
    {%- endif -%}

    {%- if request.page_type == 'customers/account' or request.page_type == 'customers/order' or request.page_type == 'customers/addresses' -%}
      {%- section 'account-banner' -%}
    {%- endif -%}

    <main role="main" id="main" class="anchor">
      {{ content_for_layout }}

      {%- comment -%}
      IMPLEMENTATION NOTE: due to the very complex logic of margin/padding collapsing in Impact, the footer group is
      added into the main element to ensure that dynamic sections added into the footer group are properly laid out.
      {%- endcomment -%}
      {%- if request.page_type != 'password' -%}
        {%- sections 'footer-group' -%}
      {%- endif -%}
    </main>
    <!-- LOOX CUSTOM LAYOUT FIX -->
<script>
(function() {
  // Attendre que Loox soit chargé
  function initLooxLayout() {
    const looxContainer = document.querySelector('[id*="loox"]') || document.querySelector('.loox-reviews-default');
    
    if (!looxContainer) {
      // Réessayer dans 500ms si Loox n'est pas encore chargé
      setTimeout(initLooxLayout, 500);
      return;
    }
    
    console.log('Loox trouvé, application du layout...');
    
    // Créer le HTML des 3 blocs manuellement
    const headerHTML = `
      <div style="display: grid; grid-template-columns: 250px 1fr 200px; gap: 20px; margin-bottom: 30px; padding: 0;">
        
        <!-- Bloc 1 : Rating Summary -->
        <div style="border: 1px solid #e8e8e8; border-radius: 12px; padding: 20px; text-align: center; background: white;">
          <div style="font-size: 32px; font-weight: 900; color: #1a1a1a; margin-bottom: 5px;">4,8 sur 5</div>
          <div style="color: #03DA8E; font-size: 20px; margin-bottom: 8px;">★★★★★</div>
          <div style="font-size: 13px; color: #666;">Basé sur 1 972 avis ✅</div>
        </div>
        
        <!-- Bloc 2 : Rating Breakdown -->
        <div style="border: 1px solid #e8e8e8; border-radius: 12px; padding: 20px; background: white;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <span style="font-size: 13px; font-weight: 600; color: #1a1a1a; width: 30px;">5 ★</span>
            <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; background: #FFB800; width: 85%;"></div>
            </div>
            <span style="font-size: 13px; color: #666; width: 50px; text-align: right;">1697</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <span style="font-size: 13px; font-weight: 600; color: #1a1a1a; width: 30px;">4 ★</span>
            <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; background: #FFB800; width: 9%;"></div>
            </div>
            <span style="font-size: 13px; color: #666; width: 50px; text-align: right;">177</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <span style="font-size: 13px; font-weight: 600; color: #1a1a1a; width: 30px;">3 ★</span>
            <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; background: #FFB800; width: 3%;"></div>
            </div>
            <span style="font-size: 13px; color: #666; width: 50px; text-align: right;">59</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <span style="font-size: 13px; font-weight: 600; color: #1a1a1a; width: 30px;">2 ★</span>
            <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; background: #FFB800; width: 1%;"></div>
            </div>
            <span style="font-size: 13px; color: #666; width: 50px; text-align: right;">22</span>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 13px; font-weight: 600; color: #1a1a1a; width: 30px;">1 ★</span>
            <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; background: #FFB800; width: 1%;"></div>
            </div>
            <span style="font-size: 13px; color: #666; width: 50px; text-align: right;">17</span>
          </div>
        </div>
        
        <!-- Bloc 3 : Bouton -->
        <div style="border: 1px solid #e8e8e8; border-radius: 12px; padding: 20px; background: white; display: flex; align-items: center; justify-content: center;">
          <button onclick="window.location.href='#write-review'" style="background: #FFD5D5; color: #1a1a1a; border: none; border-radius: 12px; padding: 15px 30px; font-weight: 700; cursor: pointer; width: 100%; font-size: 15px;">
            Écrire un avis
          </button>
        </div>
        
      </div>
      
      <!-- Style responsive -->
      <style>
        @media (max-width: 768px) {
          div[data-loox-header] {
            grid-template-columns: 1fr !important;
          }
        }
      </style>
    `;
    
    // Insérer le HTML au début du container Loox
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = headerHTML;
    tempDiv.firstChild.setAttribute('data-loox-header', 'true');
    
    looxContainer.insertBefore(tempDiv.firstChild, looxContainer.firstChild);
    
    console.log('Layout des 3 blocs ajouté avec succès !');
  }
  
  // Lancer après le chargement de la page
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLooxLayout);
  } else {
    initLooxLayout();
  }
})();
</script>
<!-- FIN LOOX CUSTOM -->
  </body>
</html>